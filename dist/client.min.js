!function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a="function"==typeof require&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}for(var i="function"==typeof require&&require,o=0;o<r.length;o++)s(r[o]);return s}({1:[function(require,module){"use strict";var _utils=require("./utils"),client=_utils.client,freeze=_utils.freeze,log=_utils.log,group=_utils.group,parse=_utils.parse,values=_utils.values,header=_utils.header,not=_utils.not,objectify=_utils.objectify;module.exports=function(ripple){function cache(){if(client&&window.localStorage){clearTimeout(pending);var count=resources.length;pending=setTimeout(function(){if(count==resources.length){log("cached");var cachable=values(resources).filter(not(header("cache-control","no-store")));localStorage.ripple=freeze(objectify(cachable))}},2e3)}}var pending,resources=ripple._resources();return cache.load=function(){client&&window.localStorage&&client&&group("loading cache",function(){var offline=parse(localStorage.ripple);values(offline).forEach(ripple)})},cache}},{"./utils":6}],2:[function(require,module){"use strict";var _interopRequire=function(obj){return obj&&obj.__esModule?obj["default"]:obj},_utils=require("../utils"),is=_utils.is,promise=_utils.promise,objectAssign=_interopRequire(require("object-assign")),mysql=_interopRequire(require("./mysql")),postgres=_interopRequire(require("./postgres")),adaptors={mysql:mysql,postgres:postgres};module.exports=function(ripple){var db={};return db.all=promise.sync(1),db.noop=db.push=db.remove=db.update=promise["null"],function(config){if(!arguments.length)return db;var type=config?is.str(config)?config.split(":")[0]:config.type:void 0;return type&&objectAssign(db,adaptors[type](config)),ripple}}},{"../utils":6,"./mysql":8,"./postgres":8,"object-assign":9}],3:[function(require,module){"use strict";var _utils=require("./utils"),all=_utils.all,err=_utils.err,later=_utils.later,client=_utils.client,resourcify=_utils.resourcify,attr=_utils.attr,applyhtml=_utils.applyhtml,applycss=_utils.applycss,is=_utils.is,body=_utils.body,values=_utils.values,header=_utils.header,key=_utils.key,prepend=_utils.prepend;module.exports=function(ripple){function components(){var selector=values(resources).filter(header("content-type","application/javascript")).map(key("name")).map(prepend("body /deep/ ")).join(",");all(selector).map(invoke)}function resource(thing){var res=is.str(thing)?resources[thing]:thing;is.js(res)&&js(res),is.data(res)&&data(res.name),is.css(res)&&css(res.name),is.html(res)&&html(res.name)}function data(name){all('body /deep/ [data~="'+name+'"]:not([inert])').map(invoke)}function css(name){all('body /deep/ [css="'+name+'"]:not([inert])').map(invoke)}function html(name){all('body /deep/ [template="'+name+'"]:not([inert])').map(invoke)}function js(res){if(!is.registered(res)){var proto=Object.create(HTMLElement.prototype),opts={prototype:proto},extend=res.headers["extends"];extend&&(opts["extends"]=extend),proto.attachedCallback=proto.attributeChangedCallback=node,document.registerElement(res.name,opts)}}function node(){invoke(this)}function invoke(_x){for(var _again=!0;_again;){_again=!1;var d=_x;delay=inert=root=name=data=html=css=data=fn=html=css=void 0;{if("#text"!=d.nodeName){var delay=attr(d,"delay"),inert=attr(d,"inert");if(null!=inert)return;if(null!=delay)return d.setAttribute("inert",""),d.removeAttribute("delay"),setTimeout(d.removeAttribute.bind(d,"inert"),+delay);var root=d.shadowRoot||d.createShadowRoot(),name=attr(d,"is")||d.tagName.toLowerCase(),data=attr(d,"data")||"",html=attr(d,"template"),css=attr(d,"css"),data=resourcify(resources,data)||d.__data__,fn=body(resources,name),html=body(resources,html),css=body(resources,css);try{!(!fn||!data&&attr(d,"data")||!applyhtml(root,html)&&attr(d,"template")||!applycss(root,css)&&attr(d,"css")||!fn.call(root,data)),d.observer&&Object.unobserve(d.state,d.observer),d.state&&Object.observe(d.state,d.observer=later(ripple,d))}catch(e){err(e)}return d}_x=d.parentNode,_again=!0}}}var resources=ripple._resources();return function(thing){return client?thing?thing.nodeName?invoke(thing):this&&this.nodeName?invoke(this):this&&this.node?invoke(this.node()):is.str(thing)?resource(thing):thing.name?resource(thing):thing[0]instanceof MutationRecord?invoke(thing[0].target):err("Couldn't update",thing):components():void 0}}},{"./utils":6}],4:[function(require,module){"use strict";function createRipple(server){function ripple(){return ripple._register.apply(this,arguments)}var opts=void 0===arguments[1]?{client:!0}:arguments[1];log("creating");var resources={},app=expressify(server),socket=sio(server);return[["versions",[]],["length",0],["time",0]].map(function(_ref){var _ref2=_slicedToArray(_ref,2),key=_ref2[0],val=_ref2[1];return def(resources,key,val,!0)}),ripple._resources=function(){return resources},ripple._socket=function(){return socket},ripple._register=register(ripple),ripple.resource=chain(ripple._register,ripple),ripple.cache=cache(ripple),ripple.db=db(ripple),ripple.draw=draw(ripple),ripple.version=version(ripple),ripple.use=use(ripple),ripple.emit=!client&&sync(ripple).emit,setTimeout(ripple.cache.load,0),client?socket.on("response",ripple._register):(socket.on("connection",sync(ripple).connected),app.use(serve.render),app.use("/ripple.js",serve.client),app.use("/immutable.min.js",serve.immutable),opts.session&&socket.use(auth(opts.session)),opts.client&&app.use(append),opts.utils&&utils()),ripple}var _interopRequire=function(obj){return obj&&obj.__esModule?obj["default"]:obj},_slicedToArray=function(arr,i){if(Array.isArray(arr))return arr;if(Symbol.iterator in Object(arr)){for(var _step,_arr=[],_iterator=arr[Symbol.iterator]();!(_step=_iterator.next()).done&&(_arr.push(_step.value),!i||_arr.length!==i););return _arr}throw new TypeError("Invalid attempt to destructure non-iterable instance")},_toConsumableArray=function(arr){if(Array.isArray(arr)){for(var i=0,arr2=Array(arr.length);i<arr.length;i++)arr2[i]=arr[i];return arr2}return Array.from(arr)};module.exports=createRipple,require("colors");var _utils=require("./utils"),is=_utils.is,chain=_utils.chain,def=_utils.def,log=_utils.log,client=(_utils.noop,_utils.client),use=_utils.use,sio=_utils.sio,attr=_utils.attr,expressify=_utils.expressify,_sync=require("./sync"),auth=_sync.auth,append=_sync.append,serve=_sync.serve,register=_interopRequire(require("./register")),version=_interopRequire(require("./version")),cache=_interopRequire(require("./cache")),draw=_interopRequire(require("./draw")),sync=_interopRequire(_sync),db=_interopRequire(require("./db"));if(client&&!window.noripple){var expose=attr(document.currentScript,"utils");is.str(expose)&&utils.apply(void 0,_toConsumableArray(expose.split(" ").filter(Boolean))),client&&(window.createRipple=createRipple)&&(window.ripple=createRipple())}},{"./cache":1,"./db":2,"./draw":3,"./register":5,"./sync":8,"./utils":6,"./version":7,colors:9}],5:[function(require,module){"use strict";var _utils=require("./utils"),is=_utils.is,err=_utils.err,clone=_utils.clone,promise=_utils.promise,emitterify=_utils.emitterify,table=_utils.table,interpret=_utils.interpret,log=_utils.log,header=(_utils.parameterise,_utils.header),has=_utils.has,immmutable=_utils.immmutable,listeners=_utils.listeners,call=_utils.call,def=_utils.def,versions=_utils.versions,client=_utils.client,first=_utils.first;module.exports=function(ripple){function register(){var parsed,_ref=void 0===arguments[0]?{}:arguments[0],name=_ref.name,body=_ref.body,_ref$headers=_ref.headers,headers=void 0===_ref$headers?{}:_ref$headers,draw=ripple.draw,cache=ripple.cache,emit=ripple.emit,res={name:name,body:body,headers:headers};return interpret(res),log("registering",res.name),!(res.name in resources)&&resources.length++,parsed=is.data(res)?first(data(res)):promise(resources[res.name]=res),parsed.then(function(){client?draw(res):emit()(res.name),cache()}),res.body}function data(res){function commit(rows){res.body=rows,resources[res.name]=watch(res),listeners(resources,res.name).map(call()),client&&!rollback&&max&&version.history()}var db=ripple.db,version=ripple.version,table=header("content-location")(res),max=header("max-versions")(res),rollback=has(res.headers,"version");return client&&(max=max&&window.Immutable),max&&(res.versions=res.versions||versions(resources,res.name)),client&&!rollback&&max&&res.versions.push(immmutable(res.body)),resources[res.name]=watch(res),[db().all(table,res.body).then(commit),res]}function watch(res){function observe(d){if(is.obj(d)&&!d.observer){var fn=ometa(res.name);def(d,"observer",fn),Object.observe(d,fn)}}var opts={type:"response",listeners:listeners(resources,res.name)};return!res.body.observer&&Array.observe(res.body=emitterify(res.body,opts),def(res.body,"observer",meta(res.name))),is.arr(res.body)&&res.body.forEach(observe),res}function ometa(name){return function(changes){changes.forEach(function(change){if("update"!=!change.type){var i=resources[name].body.indexOf(change.object);resources[name].body[i]=clone(change.object)}})}}function meta(name){return function(changes){var draw=ripple.draw;log("observed changes in",name,changes.length),watch(resources[name]),changes.forEach(normalize(name)),draw(name)}}function normalize(name){return function(change){var version=ripple.version,type=change.type,removed="delete"==type?change.oldValue:change.removed&&change.removed[0],data=change.object,key=change.name||change.index,value=data[key],max=header("max-versions")(resources[name]),skip=!is.arr(data),details={name:name,key:key,value:removed||value,type:"update"==type?"update":"delete"==type?"remove":"splice"==type&&removed?"remove":"splice"!=type||removed?"add"==type?"push":!1:"push"};client&&(max=max&&window.Immutable),client&&max&&version.record(details),client&&socket.emit("change",details),!client&&crud(skip?{name:name}:details)}}function crud(_ref){var name=_ref.name,value=_ref.value,type=_ref.type,emit=ripple.emit,db=ripple.db;log("crud",name,type=type||"noop");var t=table(resources[name]),f=type&&db()[type],r=listeners(resources,name);f(t,value).then(function(id){emit()(name),r.map(call(id)),values(resources).filter(header("content-location",t)).filter(not(by("name",name))).map(data).map(async(key("name"))).map(then(emit()))})}var resources=ripple._resources(),socket=ripple._socket();return function(name,body,headers){return is.str(name)&&!body&&resources[name]?resources[name].body:!is.str(name)||body||resources[name]?is.str(name)&&body?register({name:name,body:body,headers:headers}):is.obj(name)?register(name):err("Couldn't find or create resource",name):register({name:name})}}},{"./utils":6}],6:[function(require,module,exports){(function(process,global){"use strict";function all(selector){var doc=void 0===arguments[1]?document:arguments[1];return toArray(doc.querySelectorAll(selector))}function raw(selector,context){return(context?context:document).querySelector(selector)}function toArray(d){return Array.prototype.slice.call(d,0)}function fn(resource){return isFunction(resource)?resource:new Function("return "+resource)()}function matches(k,v){return function(d){return d[k]&&v&&d[k].toLowerCase&&v.toLowerCase?d[k].toLowerCase()===v.toLowerCase():d[k]==v}}function exists(v){return function(d){return d==v}}function isString(d){return"string"==typeof d}function isNumber(d){return"number"==typeof d}function isObject(d){return"object"==typeof d}function isFunction(d){return"function"==typeof d}function isArray(d){return d instanceof Array}function values(o){return o?Object.keys(o).map(base(o)):[]}function spread(){for(var _len=arguments.length,keys=Array(_len),_key=0;_len>_key;_key++)keys[_key]=arguments[_key];return function(o){return Object.keys(o).filter(isIn(keys)).map(base(o))}}function mask(){for(var _len=arguments.length,keys=Array(_len),_key=0;_len>_key;_key++)keys[_key]=arguments[_key];return function(o){var masked={};return keys.forEach(function(key){return masked[key]=o[key]}),masked}}function isIn(set){return function(d){return set.some(match(d))}}function isDef(d){return"undefined"!=typeof d}function gt(k,v){return function(d){return d[k]>v}}function async(fn){return function(o){return[o[0],fn(o[1])]}}function base(o){return function(k){return o[k]}}function key(k){return function(o){return o[k]}}function not(fn){return function(){return!fn.apply(this,arguments)}}function freeze(r){var stripped=clone(r);return delete stripped.versions,delete stripped.length,delete stripped.time,values(r).filter(header("content-type")).map(function(res){return delete stripped[res.name].versions,res}).filter(header("content-type","application/javascript")).map(function(res){return stripped[res.name].body=res.body.toString()}),str(stripped)}function str(d){return isNumber(d)?String(d):JSON.stringify(d)}function parse(d){return d&&JSON.parse(d)}function attr(d,name,value){return d=d.node?d.node():d,isString(d)?function(){return attr(this,d)}:arguments.length>2?d.setAttribute(name,value):d.attributes.getNamedItem(name)&&d.attributes.getNamedItem(name).value}function clone(d){return isFunction(d)?d:parse(str(d))}function remove(k,v){return function(d,i,a){k||v?v?d[k]==v&&a.splice(i,1):d==k&&a.splice(i,1):d&&a.splice(i,1)}}function last(d){return d[d.length-1]}function l(d){return d.toLowerCase()}function immmutable(d){return isArray(d)?Immutable.List(d):isObject(d)?Immutable.Map(d):err(d,"is not an array or object")}function applycss(d,css){if(!css)return!1;var style=d.querySelector("style")||document.createElement("style");return style.innerHTML=css,d.insertBefore(style,d.firstChild),!0}function applyhtml(d,html){if(!html)return!1;var div=document.createElement("div");return div.innerHTML=html,d.innerHTML=div.firstChild.innerHTML,!0}function isNull(d){return null===d}function inherit(len){return function(d){return new Array((len||1)+1).join("0").split("").map(curry(identity,d))}}function first(d){return d[0]}function identity(d){return d}function table(resource){return resource.headers["content-location"]}function curry(fn,d){return function(){return fn(d)}}function index(d,i){return i}function shift(d){return Array.prototype.shift.apply(d)}function slice(d){return Array.prototype.slice.apply(d,(shift(arguments),arguments))}function pop(d){return Array.prototype.pop.apply(d)}function noop(){}function sel(){return d3.select.apply(this,arguments)}function datum(node){return d3.select(node).datum()}function def(o,p,v,w){return!has(o,p)&&Object.defineProperty(o,p,{value:v,writable:w}),o[p]}function then(fn){return function(o){return o[0].then(fn.bind(null,o[1])),o[1]}}function promise(){var resolve,reject,p=new Promise(function(res,rej){resolve=res,reject=rej});return arguments.length&&resolve(arguments[0]),p.resolve=resolve,p.reject=reject,p}function promiseSecond(table,body){return promise(body)}function promiseSync(arg){return function(){var a=arguments,o={then:function(cb){return cb(a[arg]),o}};return o}}function promiseNoop(){return promise()}function promiseNull(){return promise(null)}function objectify(rows){var by=void 0===arguments[1]?"name":arguments[1],o={};return rows.forEach(function(d){return o[d[by]]=d}),o}function arrayify(o){var by=void 0===arguments[1]?"name":arguments[1];return keys(o).map(function(k){var t={value:o[k]};return t[by]=k,t})}function unique(key){var matched={};return function(d){return matched[d[key]]?!1:matched[d[key]]=!0}}function later(ripple,d){return function(){ripple.draw(d)}}function isRoute(d){return"/"==first(d)}function header(header,value){var getter=1==arguments.length;return function(d){return has(d,"headers")&&has(d.headers,header)?getter?d.headers[header]:d.headers[header]==value:null}}function prepend(v){return function(d){return v+d}}function empty(d){return!d||isArray(d)&&!d.length}function has(o,k){return o.hasOwnProperty(k)}function once(g,selector,data,before,key){var g=g.node?g:d3.select(g),type=selector.split(".")[0]||"div",classed=selector.split(".").slice(1).join(" "),el=g.selectAll(selector).data(data||[0],key);return el.once=function(){for(var _len=arguments.length,args=Array(_len),_key=0;_len>_key;_key++)args[_key]=arguments[_key];return once.apply(void 0,[el].concat(args))},el.out=el.exit().remove(),el["in"]=el.enter().insert(type,before).classed(classed,1),el}function perf(fn){var start=performance.now();fn(),log("perf",performance.now()-start)}function group(label,fn){fn()}function body(resources,name){return resources[name]&&resources[name].body}function array(){return[]}function isJS(res){return"application/javascript"==header("content-type")(res)}function isData(res){return"application/data"==header("content-type")(res)}function isHTML(res){return"text/html"==header("content-type")(res)}function isCSS(res){return"text/css"==header("content-type")(res)}function isRegistered(res){var extend=header("extends")(res);return extend?document.createElement(extend,res.name).attachedCallback:document.createElement(res.name).attachedCallback}function call(param){return function(d,i,a){try{(d.once?a.splice(i,1).pop().fn:d.fn)(param)}catch(e){err(e)}}}function emitterify(body,opts){function on(type,callback,opts){return log("registering callback",type),opts=opts||{},opts.fn=callback,this.on[type]=this.on[type]||[],this.on[type].push(opts),this}function once(type,callback){return this.on.call(this,type,callback,{once:!0}),this}return def(body,"on",on),def(body,"once",once),opts&&(body.on[opts.type]=opts.listeners),body}function indexOf(pattern){return function(d){return~d.indexOf(pattern)}}function listeners(resources,name){var r=resources[name];return r&&r.body&&r.body.on&&r.body.on.response||[]}function versions(resources,name){return resources[name]&&resources[name].versions||[]}function use(ripple){function cloneBody(d){return isObject(d.body)&&(d.body=clone(d.body)),d}return function(d){return values(d._resources()).map(cloneBody).map(ripple),ripple}}function chain(fn,value){return function(){return fn.apply(this,arguments),value}}function sio(opts){return client?window.io?window.io():{on:noop,emit:noop}:require("socket.io")(opts)}function parameterise(route){var name=route.split("/")[1];return function(params){return{name:name,params:params}}}function resourcify(resources,d){var o={},names=d?d.split(" "):[];return 0==names.length?void 0:1==names.length?body(resources,first(names)):(names.map(function(d){return o[d]=body(resources,d)}),values(o).some(empty)?void 0:o)}function interpret(res){isString(res.body)&&!header("content-type")(res)&&(res.headers["content-type"]="text/html")&&~res.name.indexOf(".css")&&(res.headers["content-type"]="text/css"),isFunction(res.body)&&!header("content-type")(res)&&(res.headers["content-type"]="application/javascript"),!header("content-type")(res)&&(res.headers["content-type"]="application/data"),!res.body&&(res.body=[]),isJS(res)&&(res.body=fn(res.body)),isData(res)&&(res.headers={"content-type":"application/data","content-location":res.headers["content-location"]||res.headers.table||res.name,"private":res.headers["private"],"proxy-to":res.headers["proxy-to"]||res.headers.to,"proxy-from":res.headers["proxy-from"]||res.headers.from,version:res.headers.version,"cache-control":isNull(res.headers.cache)?"no-store":res.headers["cache-control"]||res.headers.cache,"max-versions":isNumber(header("max-versions")(res))?header("max-versions")(res):1/0}),clean(res.headers)}function clean(o){Object.keys(o).forEach(function(k){!isDef(key(k)(o))&&delete o[k]})}function keys(o){return Object.keys(o)}function globalise(d){owner[d]=exports[d]}function expressify(d){return!client&&d&&d._events.request||{use:noop}}function fromParent(d){return datum(this.parentNode)[d]}function deidify(name,value){return ripple(name).filter(by("id",value)).map(key("name")).pop()}function colorfill(){client&&["red","green","bold","grey"].forEach(function(color){Object.defineProperty(String.prototype,color,{get:function(){return this}})})}function file(name){return require("fs").readFileSync(name,{encoding:"utf8"})}exports.all=all,exports.raw=raw,exports.toArray=toArray,exports.fn=fn,exports.matches=matches,exports.exists=exists,exports.isString=isString,exports.isNumber=isNumber,exports.isObject=isObject,exports.isFunction=isFunction,exports.isArray=isArray,exports.values=values,exports.spread=spread,exports.mask=mask,exports.isIn=isIn,exports.isDef=isDef,exports.gt=gt,exports.async=async,exports.base=base,exports.key=key,exports.not=not,exports.freeze=freeze,exports.str=str,exports.parse=parse,exports.attr=attr,exports.clone=clone,exports.remove=remove,exports.last=last,exports.l=l,exports.immmutable=immmutable,exports.applycss=applycss,exports.applyhtml=applyhtml,exports.isNull=isNull,exports.inherit=inherit,exports.first=first,exports.identity=identity,exports.table=table,exports.curry=curry,exports.index=index,exports.shift=shift,exports.slice=slice,exports.pop=pop,exports.noop=noop,exports.sel=sel,exports.datum=datum,exports.def=def,exports.then=then,exports.promise=promise,exports.promiseSecond=promiseSecond,exports.promiseSync=promiseSync,exports.promiseNoop=promiseNoop,exports.promiseNull=promiseNull,exports.objectify=objectify,exports.arrayify=arrayify,exports.unique=unique,exports.later=later,exports.isRoute=isRoute,exports.header=header,exports.prepend=prepend,exports.empty=empty,exports.has=has,exports.once=once,exports.perf=perf,exports.group=group,exports.body=body,exports.array=array,exports.isJS=isJS,exports.isData=isData,exports.isHTML=isHTML,exports.isCSS=isCSS,exports.isRegistered=isRegistered,exports.call=call,exports.emitterify=emitterify,exports.indexOf=indexOf,exports.listeners=listeners,exports.versions=versions,exports.use=use,exports.chain=chain,exports.sio=sio,exports.parameterise=parameterise,exports.resourcify=resourcify,exports.interpret=interpret,exports.clean=clean,exports.keys=keys,exports.globalise=globalise,exports.expressify=expressify,exports.fromParent=fromParent,exports.deidify=deidify,exports.colorfill=colorfill,exports.file=file;var by=exports.by=matches,match=exports.match=exists;promise.sync=promiseSync,promise["null"]=promiseNull,promise.noop=promiseNoop,promise.second=promiseSecond;var client=(exports.is={str:isString,data:isData,num:isNumber,obj:isObject,"in":isIn,def:isDef,func:isFunction,registered:isRegistered,js:isJS,css:isCSS,html:isHTML,arr:isArray,route:isRoute,"null":isNull},exports.to={arr:toArray},exports.client="undefined"!=typeof window),owner=exports.owner=client?window:global,min=exports.min=client?!0:"debug"!==process.env.NODE_ENV;colorfill();var log=exports.log=min?noop:console.log.bind(console,"[ripple]".grey),err=exports.err=min?noop:console.error.bind(console,"[ripple]".red);owner.utils=function(){for(var _len=arguments.length,d=Array(_len),_key=0;_len>_key;_key++)d[_key]=arguments[_key];return(d.length?d:keys(exports)).forEach(globalise)},Object.defineProperty(exports,"__esModule",{value:!0})}).call(this,require("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{_process:10,fs:8,"socket.io":9}],7:[function(require,module){"use strict";var _utils=require("./utils"),is=_utils.is,header=_utils.header,versions=_utils.versions,log=_utils.log,err=_utils.err,last=_utils.last,values=_utils.values,client=_utils.client;module.exports=function(ripple){function version(name,version){return client?2==arguments.length?resource({name:name,index:version}):1==arguments.length&&is.str(name)?resource(name):1==arguments.length&&is.num(name)?application(name):0==arguments.length?application():err("Couldn't rollback",name,version):void 0}function resource(o){var register=ripple._register;return is.str(o)?is.num(header("version")(resources[o]))?header("version")(resources[o]):versions(resources,o).length-1:resources[o.name].versions&&resources[o.name].versions.length?o.index<0||o.index>resources[o.name].versions.length-1?err(o.index,"time does not exist for",o.name):(register({name:o.name,headers:{"content-type":"application/data",version:o.index},body:resources[o.name].versions[o.index].toJS()}),ripple(o.name)):log(o.name,"does not have a history")}function application(time){var draw=ripple.draw;return arguments.length?0>time||time>resources.versions.length-1?err(time,"time does not exist"):(log("travelling to",time),resources.versions[resources.time=time].forEach(resource),void draw()):resources.time}var resources=ripple._resources();return version.record=function(_ref){var name=_ref.name,key=_ref.key,value=_ref.value,type=_ref.type;if(client){var resource=resources[name],versions=resource.versions,previous=last(versions),latest="update"==type?previous.set(key,value):"push"==type?previous.set(key,value):"remove"==type?previous.remove(key,value):!1;return versions.push(latest),version.history()}},version.history=function(){function index(r){return delete r.headers.version,{name:r.name,index:(r.versions||[]).length-1}}client&&(resources.versions.push(values(resources).filter(header("content-type","application/data")).map(index)),resources.time=resources.versions.length-1)},version}},{"./utils":6}],8:[function(){},{}],9:[function(require,module,exports){arguments[4][8][0].apply(exports,arguments)},{dup:8}],10:[function(require,module){function drainQueue(){if(!draining){draining=!0;for(var currentQueue,len=queue.length;len;){currentQueue=queue,queue=[];for(var i=-1;++i<len;)currentQueue[i]();len=queue.length}draining=!1}}function noop(){}var process=module.exports={},queue=[],draining=!1;process.nextTick=function(fun){queue.push(fun),draining||setTimeout(drainQueue,0)},process.title="browser",process.browser=!0,process.env={},process.argv=[],process.version="",process.on=noop,process.addListener=noop,process.once=noop,process.off=noop,process.removeListener=noop,process.removeAllListeners=noop,process.emit=noop,process.binding=function(){throw new Error("process.binding is not supported")},process.cwd=function(){return"/"},process.chdir=function(){throw new Error("process.chdir is not supported")},process.umask=function(){return 0}},{}]},{},[4]);